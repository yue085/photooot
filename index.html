<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的照片墙</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { width: 100%; height: 100%; overflow: hidden; background: #000; font-family: sans-serif; }

        /* 加载提示 */
        #loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #666; z-index: 999;
        }

        /* 全屏滑动容器 */
        .slider { width: 100%; height: 100%; position: relative; overflow: hidden; display: none; }
        .slide-wrapper { display: flex; height: 100%; transition: transform 0.4s ease; }
        .slide {
            width: 100vw; height: 100%; flex-shrink: 0;
            display: flex; align-items: center; justify-content: center;
        }
        .slide img {
            max-width: 100%; max-height: 100%;
            object-fit: contain; user-select: none;
            pointer-events: none;
        }

        /* 底部指示器 */
        .pagination {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 8px; z-index: 10;
        }
        .dot {
            width: 8px; height: 8px; border-radius: 50%;
            background: rgba(255,255,255,0.3); cursor: pointer;
            transition: all 0.3s;
        }
        .dot.active { background: #fff; transform: scale(1.2); }
    </style>
</head>
<body>

<div id="loading">正在加载照片...</div>

<div class="slider" id="slider">
    <div class="slide-wrapper" id="slideWrapper"></div>
    <div class="pagination" id="pagination"></div>
</div>

<script>
    // ====================== 请在这里配置你的信息 ======================
    const CONFIG = {
        owner: 'yue085',    // 例如: 'zhangsan'
        repo: 'photooot',           // 例如: 'my-photo-wall'
        branch: 'main',               // 通常是 main 或 gh-pages 或 master
        folder: 'images'              // 图片文件夹名，不用改
    };
    // ===================================================================

    const slideWrapper = document.getElementById('slideWrapper');
    const pagination = document.getElementById('pagination');
    const sliderEl = document.getElementById('slider');
    const loadingEl = document.getElementById('loading');
    
    let currentIndex = 0;
    let startX = 0;
    let moveX = 0;
    let images = [];

    // 1. 通过 GitHub API 获取图片列表
    async function fetchImages() {
        const apiUrl = `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.folder}?ref=${CONFIG.branch}`;
        
        try {
            const response = await fetch(apiUrl);
            if (!response.ok) throw new Error("无法读取仓库，请检查配置");
            
            const data = await response.json();
            
            // 过滤文件，只保留图片 (支持 jpg, png, gif, webp, jpeg, svg)
            const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.svg'];
            images = data
                .filter(item => item.type === 'file' && imageExtensions.some(ext => item.name.toLowerCase().endsWith(ext)))
                // 这里可以按名字排序，如果你想按时间排序，需要稍微复杂点的逻辑
                .sort((a, b) => a.name.localeCompare(b.name)) 
                .map(item => item.download_url); // 获取 raw 链接

            if (images.length === 0) {
                loadingEl.innerText = "images 文件夹为空，请先上传图片！";
                return;
            }

            init();
        } catch (err) {
            console.error(err);
            loadingEl.innerText = "加载失败，请检查网络或仓库配置 (用户名/仓库名/分支名)";
        }
    }

    // 2. 初始化渲染
    function init() {
        renderSlides();
        renderPagination();
        goToSlide(0);
        
        loadingEl.style.display = 'none';
        sliderEl.style.display = 'block';
        
        bindEvents();
    }

    function renderSlides() {
        slideWrapper.innerHTML = '';
        images.forEach(src => {
            const slide = document.createElement('div');
            slide.className = 'slide';
            // 添加 loading="lazy" 优化加载
            slide.innerHTML = `<img src="${src}" alt="photo" loading="lazy">`;
            slideWrapper.appendChild(slide);
        });
    }

    function renderPagination() {
        pagination.innerHTML = '';
        images.forEach((_, i) => {
            const dot = document.createElement('div');
            dot.className = 'dot';
            dot.onclick = () => goToSlide(i);
            pagination.appendChild(dot);
        });
    }

    function goToSlide(index) {
        currentIndex = Math.max(0, Math.min(index, images.length - 1));
        slideWrapper.style.transform = `translateX(-${currentIndex * 100}vw)`;
        
        // 更新指示器
        const dots = document.querySelectorAll('.dot');
        dots.forEach((dot, i) => {
            dot.classList.toggle('active', i === currentIndex);
        });
    }

    function bindEvents() {
        // 触摸滑动
        slideWrapper.addEventListener('touchstart', e => { startX = e.touches[0].clientX; });
        slideWrapper.addEventListener('touchmove', e => { moveX = e.touches[0].clientX - startX; });
        slideWrapper.addEventListener('touchend', () => {
            if (moveX < -50) goToSlide(currentIndex + 1);
            else if (moveX > 50) goToSlide(currentIndex - 1);
            moveX = 0;
        });

        // 键盘控制
        document.addEventListener('keydown', e => {
            if (e.key === 'ArrowRight') goToSlide(currentIndex + 1);
            if (e.key === 'ArrowLeft')  goToSlide(currentIndex - 1);
        });

        // 鼠标滚轮控制 (可选)
        document.addEventListener('wheel', e => {
            if (e.deltaY > 0) goToSlide(currentIndex + 1);
            else if (e.deltaY < 0) goToSlide(currentIndex - 1);
        });
    }

    // 启动
    fetchImages();
</script>

</body>
</html>
